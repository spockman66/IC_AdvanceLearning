# 数码相机中的原理和信号处理  

简介CMOS数码相机的工作全流程，图像处理算法及硬件实现，分为两部分
- 经典作品CMOS图像传感器《数码相机中的原理和信号处理》的阅读记录，CMOS技术专家，日本人Nakamura所著
- ISP（图像信号处理）算法概述、工作原理、架构、处理流程


## CMOS成像原理
---    
占坑，待更新 2023.02.25

## 噪声分析
---    



## 图像信号处理（ISP）

- ISP（图像信号处理器）的输出数据，如做AEC（自动曝光控制）、AGC（自动增益控制）、AWB（自动白平衡）、色彩校正、Lens Shading、Gamma 校正、祛除坏点、Auto Black Level、Auto White Level等等
- DSP（数字信号处理器），它可以做些拍照以及回显，录像以及回放，例如JPEG的编解码，H.264编解码等等


**ISP处理流程**
1. 透镜光学图像投射，经过光电转换为模拟电信号，消噪声后经过 A/D 转换后变为数字Bayer图像信号
2. 黑电平补偿（black level compensation）
3. 镜头矫正（lens shading correction）
4. 坏像素矫正（bad pixel correction）
5. 颜色插值 （demosaic）
6. Bayer噪声去除
7. 白平衡（awb）
8. 矫正色彩矫正（color correction, CCM）
9. gamma矫正
10. 色彩空间转换（RGB->YUV）
11. 彩噪去除与边缘加强、色彩与对比度加强
12. 输出 YUV或RGB格式的数据



### **坏点校正**

5x5领域内的8个临近像素同时大于或同时小于中心像素，且差值大于门限，则认为坏点，使用中值替换
 

### **黑电平校正**
<div align=center>
<img src="./Img/硬件加速课程/2.1.1.png" alt="暗电流" width=50%>
</div>   


黑电平产生原因
- 暗电流（无照电流），反向击穿段的电流
- AD无法将微弱电流进行转换，需要加一个固定值再转换
- 人眼对黑色更敏感，因此牺牲亮度细节

三种方法
- 减去固定值
- ISO关联
- 查表拟合

只减绿色


### **拜耳降噪**
可选择的高斯滤波器


### **去马赛克（demosaic）**


### **镜头矫正**


### **镜头矫正**

镜头本身的物理性质，造成图像四周亮度相对中心亮度逐渐降低，以及，由于图像光照在透过镜头照射到 pixel 上时，边角处的焦点夹角大于中心焦点夹角，造成边角失光。表现在图像上的效果就是亮度从图像中心到四周逐渐衰减， 且离图像中心越远亮度越暗。 为了补偿四周的亮度， 需要进行 Lens Shading 的矫正。

Lens Shading 的矫正的方法是根据一定的算法计算每个像素对应的亮度矫正值，从而补偿周边衰减的亮度。